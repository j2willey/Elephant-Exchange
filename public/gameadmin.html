<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elephant Exchange - Host</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="js/gamelib.js" defer></script>
    <script src="js/gameadmin.js" defer></script>
    <style>
        /* --- 1. GLOBAL RESET & LAYOUT --- */
        * { box-sizing: border-box; } 

        body { 
            /* Minimized padding for maximum screen usage */
            padding: 5px 5px 80px 5px; 
            margin: 0;
            width: 100vw;      
            max-width: 100% !important; 
            overflow-x: hidden; 
        }
        
        .admin-banner {
            background-color: var(--primary, #2563eb);
            color: white;
            padding: 10px 15px;
            text-align: center;
            border-radius: 6px 6px 0 0;
        }
        .admin-banner h1 { margin: 0; font-size: 1.5rem; }
        .admin-banner .tagline { font-size: 0.8rem; opacity: 0.9; font-style: italic; margin-top: 3px; }

        .menu-bar {
            background: #f3f4f6;
            padding: 8px 15px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            align-items: center;
            border-radius: 0 0 6px 6px;
            margin-bottom: 10px;
        }

        .admin-footer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; border-top: 1px solid #e5e7eb;
            padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        /* --- 2. FLUID DASHBOARD GRID --- */
        .main-layout {
            display: flex;
            gap: 10px;       
            align-items: flex-start;
            width: 100%;
        }

        .sidebar {
            /* Takes 30% of space, but floor is 450px */
            flex: 3; 
            min-width: 450px;
        }

        .content {
            /* Takes 70% of space */
            flex: 7;
            min-width: 0; 
        }

        /* --- 3. ACTIVE PLAYER BUTTONS --- */
        .action-buttons {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        .action-buttons button {
            padding: 8px 4px;
            font-size: 0.85rem;
            white-space: nowrap; 
            flex: 1; 
        }

        /* --- 4. RESPONSIVE BREAKPOINT --- */
        @media (max-width: 850px) {
            .main-layout { flex-direction: column; }
            .sidebar, .content { 
                width: 100%; 
                flex: none; 
                min-width: 0;
            }
            .sidebar { margin-bottom: 20px; }
        }
        
        #displayGameId { display: none; }
        .menu-label { font-size: 0.85rem; font-weight: 600; color: #6b7280; margin-right: 5px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="login-section" class="container" style="text-align:center; margin-top:100px;">
        <div class="card" style="max-width:400px; margin:0 auto; padding:40px;">
            <h2>Elephant Exchange</h2>
            <input type="text" id="gameIdInput" placeholder="Enter Game ID" 
                   style="width:100%; padding:15px; font-size:1.2rem; margin:20px 0; border:1px solid #ccc; border-radius:8px;">
            <button onclick="joinGame()" class="btn-primary" style="width:100%; font-size:1.2rem;">Start Managing</button>
        </div>
    </div>

    <div id="dashboard-section" class="hidden">
        
        <header class="admin-banner">
            <h1 id="bannerTitle">Elephant Exchange</h1>
            <div id="bannerTagline" class="tagline"></div>
        </header>

        <div class="menu-bar">
            <div style="margin-right: auto; display: flex; gap: 5px; align-items: center;">
                <span class="menu-label">TV View:</span>
                <button id="btnTvRules"  onclick="setTvMode('rules')"   class="btn-toggle" title="Show Rules">Rules</button>
                <button id="btnTvQr"     onclick="setTvMode('qr')"      class="btn-toggle" title="Show Join QR">QR</button>
                <button id="btnTvGrid"   onclick="setTvMode('catalog')" class="btn-toggle" title="Show Grid View">Catalog</button>
                <button id="btnTvList"   onclick="setTvMode(null)"      class="btn-toggle active" title="Show Game List">Gifts</button>
            </div>

            <div style="display:flex; gap:10px; align-items: center;">
                <span class="menu-label">Admin:</span>
                <button onclick="showLocalQr()" class="btn-toggle" title="Show QR on this screen">Invite</button>
                <button onclick="openCatalog()" class="btn-toggle" title="Open Catalog in new window">Catalog</button>
                <a href="/faq.html" target="_blank" class="btn-toggle" title="View Help">Help</a>
                <button onclick="openSettings()" class="btn-toggle" title="Game Settings">Settings</button>
            </div>
        </div>

        <div class="main-layout">
            <aside class="sidebar">
                <div class="card">
                    <h3>Participants</h3>
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <input type="number" id="pNumber" placeholder="#" style="width:50px;">
                        <input type="text" id="pName" placeholder="Name" style="flex:1;">
                        <button onclick="addParticipant()" class="btn-primary">Add</button>
                    </div>
                    <ul id="participantList" class="participant-list"></ul>
                </div>
                <div id="displayGameId"></div>
            </aside>

            <main class="content">
                <div id="phaseControls" style="margin-bottom: 20px;"></div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3>Gift Tracker</h3>
                    </div>
                    <ul id="giftList" class="gift-list"></ul>
                </div>
            </main>
        </div>

        <footer class="admin-footer">
            <button onclick="confirmEndGame()" class="btn-red" title="End Game">ðŸ›‘ End Game</button>
            
            <div class="scale-control">
                <span>UI Size:</span>
                <input type="range" id="uiScale" min="0.5" max="1.5" step="0.1" value="1" style="width:80px;">
            </div>
        </footer>
    </div>

    <div id="settingsModal" class="admin-modal-overlay hidden">
        <div class="admin-modal-content">
            <h3>Game Settings</h3>
            
            <div class="setting-row">
                <label>Party Name (Banner)</label>
                <input type="text" id="settingPartyName">
            </div>
            <div class="setting-row">
                <label>Tagline</label>
                <input type="text" id="settingTagline">
            </div>

            <hr style="margin: 15px 0; border:0; border-top:1px solid #eee;">

            <div class="setting-row">
                <label>Turn Duration (Seconds)</label>
                <input type="number" id="settingDuration">
            </div>
            <div class="setting-row">
                <label>Max Steals per Gift</label>
                <input type="number" id="settingMaxSteals">
            </div>
            <div class="setting-row">
                <label>Active Players at Once</label>
                <input type="number" id="settingActiveCount">
            </div>
            <div class="setting-row">
                <label>TV Scroll Speed</label>
                <input type="range" id="settingScrollSpeed" min="0" max="10">
            </div>
            <div class="setting-row">
                <label>Sound Theme</label>
                <select id="settingSoundTheme">
                    <option value="standard">Standard</option>
                    <option value="fun">Fun / Cartoon</option>
                    <option value="minimal">Minimal</option>
                </select>
            </div>
            
            <div class="setting-row" style="margin-top:20px;">
                <label>Theme Color</label>
                <input type="color" id="settingThemeColor">
            </div>
            
            <div style="margin-top:20px; text-align:right;">
                <button onclick="cancelSettings()" class="btn-gray">Cancel</button>
                <button onclick="saveSettings()" class="btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="localQrModal" class="admin-modal-overlay hidden">
        <div class="admin-modal-content" style="max-width:350px; text-align:center;">
            <h3>ðŸ“± Private QR Code</h3>
            <p>Scan to join <b><span id="qrGameIdDisplay"></span></b></p>
            <div id="localQrcode" style="margin:20px auto; display:inline-block; background: white; padding: 10px; border-radius: 8px;"></div>
            <br>
            <button onclick="closeLocalQr()" class="btn-gray">Close</button>
        </div>
    </div>

    <div id="imageModal" class="admin-modal-overlay">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h3 id="imgModalTitle" style="margin:0;">Manage Images</h3>
                <button onclick="closeImgModal()" class="close-modal-btn">&times;</button>
            </div>
            <div class="admin-modal-body">
                <div id="imgList" class="admin-img-grid"></div>
            </div>
            <div class="admin-modal-footer">
                <input type="file" id="adminFileInput" accept="image/*">
                <button onclick="adminUpload()" class="btn-primary">Upload</button>
            </div>
        </div>
    </div>
</body>
</html>
